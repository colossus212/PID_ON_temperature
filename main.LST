C51 COMPILER V6.12  MAIN                                                                   08/04/2013 00:57:15 PAGE 1   


C51 COMPILER V6.12, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE .\main.c DEBUG OBJECTEXTEND

stmt level    source

   1          #include"STC_NEW_8051.h"
   2          #include"defines.h"
   3          #include"18b20.h"
   4          #include"uartTimer1.h"
   5          #include"pid.h"
   6          #include"seg8.h"
   7          #include"LCD_driver.h"
   8          #include<stdio.h>
   9          
  10          sbit NOHOT=P2^1;
  11          sbit KEY0=P3^7;
  12          sbit KEY1=P3^6;
  13          
  14          uint16 t5ms=0;
  15          uint8 t1s=0;
  16          
  17          void Timer0Init(void)		//5毫秒@11.0592MHz
  18          {
  19   1      	AUXR &= 0x7F;		//定时器时钟12T模式
  20   1      	TMOD &= 0xF0;		//设置定时器模式
  21   1      	TMOD |= 0x01;		//设置定时器模式
  22   1      	TL0 = 0x00;		//设置定时初值
  23   1      	TH0 = 0xEE;		//设置定时初值
  24   1      	TF0 = 0;		//清除TF0标志
  25   1      	TR0 = 1;		//定时器0开始计时
  26   1      
  27   1      	ET0=1;
  28   1      	EA=1;
  29   1      }
  30          
  31          void initAll()
  32          {
  33   1      	Init_DS18B20();
  34   1      	Config18b20();
  35   1      	UartInit();
  36   1      	Timer0Init();
  37   1      	InitSerialPortSEG8();
  38   1      	LCD_Init();
  39   1      	PantLCD(0x00,0x00);
  40   1      }
  41          void main()
  42          {
  43   1      	xdata PIDValueStr PID;
  44   1      	uint16 t5ms_old=t5ms;
  45   1      	uint8 pressed=0;
  46   1      	uint8 added=0;
  47   1      	uint8 x=0,y=0,x_o=0,y_o=0;
  48   1      	initAll();
  49   1      	printf("INIT OK!\n");
  50   1      	PID.KP_Uint8=2;
  51   1      	PID.KI_Uint8=2;
  52   1      	PID.KD_Uint8=0;
  53   1      	PID.RK_Uint16=400;//设定值
  54   1      	while(1)
  55   1      	{
C51 COMPILER V6.12  MAIN                                                                   08/04/2013 00:57:15 PAGE 2   

  56   2      		LCD_CS =0;
  57   2      		LCDLineDDA(0,0,100,100);
  58   2      		LCD_CS =1;
  59   2      		if(t1s)
  60   2      		{
  61   3      			PID.CK_Uint16=get_temp();
  62   3      			PIDOperation(&PID);
  63   3      			printf("set temp:%d",PID.RK_Uint16);
  64   3      			printf("set:%d",PID.Uk_Uint16);
  65   3      			printf("temp:%d\n",PID.CK_Uint16);
  66   3      			t1s=0;
  67   3      			x_o=x;
  68   3      			y_o=y;
  69   3      			x=x_o+4;
  70   3      			y=PID.CK_Uint16/4;
  71   3      			LCDLineDDA(x_o,y_o,x,y);
  72   3      		}
  73   2      		//if(t5ms!=t5ms_old)
  74   2      		if(t5ms%2)
  75   2      		{
  76   3      			//t5ms_old=t5ms;
  77   3      			if(PID.Uk_Uint16>(uint16)t5ms/2)
  78   3      			{
  79   4      				NOHOT=0;
  80   4      			}else
  81   3      			{
  82   4      				NOHOT=1;
  83   4      			}
  84   3      		}
  85   2      		if(KEY0==0||KEY1==0)
  86   2      		{
  87   3      			if(pressed)
  88   3      			{
  89   4      				if(((t5ms>t5ms_old)&&(t5ms-t5ms_old>=2))||(t5ms<t5ms_old&&t5ms+200-t5ms_old>=2))
  90   4      				{
  91   5      					if(!added)
  92   5      					{
  93   6      						if(KEY0==0)
  94   6      						{
  95   7      							PID.RK_Uint16=PID.RK_Uint16+100;
  96   7      						}
  97   6      						if(KEY1==0)
  98   6      						{
  99   7      							PID.RK_Uint16=PID.RK_Uint16+10;
 100   7      						}
 101   6      					}
 102   5      					added=1;
 103   5      				}
 104   4      			}else
 105   3      			{
 106   4      				
 107   4      				pressed=1;
 108   4      				t5ms_old=t5ms;
 109   4      			}
 110   3      		}
 111   2      		if(KEY0==1&&KEY1==1)
 112   2      		{
 113   3      			added=0;
 114   3      		}
 115   2      		if(PID.RK_Uint16>900)
 116   2      		{
 117   3      			PID.RK_Uint16=400;
C51 COMPILER V6.12  MAIN                                                                   08/04/2013 00:57:15 PAGE 3   

 118   3      		}
 119   2      		seg8Disp(PID.CK_Uint16,0,2);
 120   2      		seg8Disp(PID.RK_Uint16,1,2);
 121   2      	}
 122   1      }
 123          
 124          void timer0()interrupt 1
 125          {
 126   1      	t5ms++;
 127   1      	if(t5ms>=200)
 128   1      	{
 129   2      		t5ms=0;
 130   2      		t1s++;
 131   2      	}
 132   1      	TL0 = 0x00;		//设置定时初值
 133   1      	TH0 = 0xEE;		//设置定时初值
 134   1      }	 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    529    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =   ----      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
